<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enlist Info - Solve-A-Thon 1.0</title>
    <meta name="description"
        content="Register for Solve-A-Thon 1.0. Choose your category: UG (BCA/BSc) or PG/Engineering (MCA/MSc/BE).">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="icon" href="elements/favicon.jpg">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- GSAP Script -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <!-- Backend Integration -->
    <!-- Removed Firebase SDKs as we are now using a custom Node.js Backend -->
</head>


<body>

    <!-- Simple Loader -->
    <div id="loader" class="page-loader">
        <div class="jet-container">
            <img src="elements/loading_jet.png" alt="Loading" class="loading-jet-img-sm">
        </div>
    </div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="logo">
            <a href="index.html" class="logo-text">
                SOLVEATHON 1.0 <i class="fa-solid fa-jet-fighter-up"></i>
            </a>
        </div>
        <ul class="nav-links">
            <li><a href="index.html#home">Home</a></li>
            <li><a href="user_login.html">Login</a></li>
            <li><a href="user_register.html" class="nav-btn active-page">Sign Up</a></li>
        </ul>
        <div class="hamburger">
            <span class="bar"></span>
            <span class="bar"></span>
            <span class="bar"></span>
        </div>
    </nav>

    <!-- Registration Section -->
    <section id="register-page">
        <div class="container" style="display: flex; justify-content: center;">

            <div class="form-panel"
                style="max-width: 500px; margin-top: 2rem; opacity: 1; height: auto; border-color: var(--primary-color);">
                <div class="form-header" style="justify-content: center;">
                    <h3><i class="fa-solid fa-user-plus"></i> New Account</h3>
                </div>

                <form id="signupForm">

                    <div class="input-group">
                        <label>Category</label>
                        <select name="category"
                            style="background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); padding: 12px; color: #fff; width: 100%; border-radius: 5px;">
                            <option value="UG" style="background: #000;">Cadet League (BCA/BSc)</option>
                            <option value="PG" style="background: #000;">Commander League (MCA/MSc/BE)</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label>College Name</label>
                        <input type="text" name="college_name" placeholder="Enter College Name" required>
                    </div>

                    <div class="input-group">
                        <label>Team Name</label>
                        <input type="text" name="team_name" placeholder="Enter Team Name" required>
                    </div>

                    <div class="input-group">
                        <label>Team Leader Name</label>
                        <input type="text" name="leader_name" placeholder="Full Name" required>
                    </div>

                    <div class="input-group">
                        <label>Email ID</label>
                        <input type="email" name="email" placeholder="email@example.com" required>
                    </div>

                    <div class="input-group">
                        <label>Password</label>
                        <input type="password" name="password" placeholder="Create Password" required>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn primary-btn glow-effect" style="width: 100%;">Create
                            Account</button>
                    </div>

                    <p style="text-align: center; margin-top: 1.5rem; color: #aaa;">
                        Already have an account? <a href="user_login.html" style="color: var(--primary-color);">Login
                            here</a>
                    </p>

                </form>
            </div>

        </div>

        <!-- Background Elements -->
        <div class="hero-background">
            <div class="stars"></div>
            <div class="twinkling"></div>
        </div>
    </section>

    <!-- Success Modal -->
    <div id="success-modal" class="success-modal">
        <div class="success-content">
            <i class="fa-solid fa-circle-check success-icon"></i>
            <h2 class="success-title">Account Created!</h2>
            <p id="success-text" class="success-message">Welcome to the squadron.</p>
        </div>
    </div>

    <!-- Contact Section -->
    <footer id="footer">
        <div class="footer-container">
            <div class="footer-bottom">
                <p>&copy; 2026 Solve-A-Thon 1.0 | Department of MCA, SIT</p>
            </div>
        </div>
    </footer>

    <script src="config.js"></script>
    <script>
        // Loader
        window.addEventListener('load', () => {
            const loader = document.getElementById('loader');
            if (loader) {
                gsap.to(loader, { opacity: 0, duration: 0.5, onComplete: () => loader.style.display = 'none' });
            }
        });

        // Hamburger
        const hamburger = document.querySelector('.hamburger');
        const navLinks = document.querySelector('.nav-links');
        if (hamburger) {
            hamburger.addEventListener('click', () => {
                hamburger.classList.toggle('active');
                navLinks.classList.toggle('active');
            });
        }

        // Success Modal Logic
        function showSuccess(message, redirectUrl) {
            const modal = document.getElementById('success-modal');
            const content = modal.querySelector('.success-content');
            const textElement = document.getElementById('success-text');

            textElement.innerText = message;
            modal.style.display = 'flex';

            // Animate In
            gsap.to(content, { opacity: 1, scale: 1, duration: 0.5, ease: "back.out(1.7)" });

            // Redirect after delay
            setTimeout(() => {
                window.location.href = redirectUrl;
            }, 2500);
        }

        // Signup Logic
        const signupForm = document.getElementById('signupForm');
        signupForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = signupForm.querySelector('button');
            const originalText = btn.innerText;
            btn.disabled = true;
            btn.innerText = "Creating Account...";

            const formData = new FormData(signupForm);
            const data = Object.fromEntries(formData.entries());

            try {
                // Send to Backend
                const response = await fetch(`${API_CONFIG.BASE_URL}/api/auth/signup`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const responseText = await response.text();
                let result;
                try {
                    result = JSON.parse(responseText);
                } catch (e) {
                    console.error("Non-JSON response:", responseText);
                    alert("Server Error: Response was not JSON.");
                    throw new Error("Server Error: Response was not JSON.");
                }

                if (!response.ok) {
                    throw new Error(result.message || 'Server error');
                }

                if (result.success) {
                    // Auto-Login
                    if (result.user) {
                        localStorage.setItem('solveathon_user', JSON.stringify(result.user));
                        showSuccess("Account Created! Proceeding to Mission Enlistment...", 'register.html');
                    } else {
                        showSuccess("Account Created! Please login.", 'user_login.html');
                    }
                } else {
                    alert(result.message);
                }
            } catch (err) {
                console.error(err);
                alert("Error: " + err.message);
            } finally {
                btn.disabled = false;
                btn.innerText = originalText;
            }
        });
    </script>
</body>